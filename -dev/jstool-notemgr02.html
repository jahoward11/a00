<!DOCTYPE html>
<html lang=en>
<title>Note Manager</title>
<meta charset="utf-8">
<meta name=viewport content="width=device-width, initial-scale=1">

<div id=nmwrap>
<style>
*, *::before, *::after { box-sizing: inherit; }
html {
  box-sizing: border-box;
  color: DimGrey;
  min-width: 375px;
  overflow-wrap: break-word;
  text-rendering: optimizeLegibility;
  -moz-osx-font-smoothing: grayscale;
  -webkit-font-smoothing: antialiased;
  -webkit-text-size-adjust: 100%;
  -moz-text-size-adjust: 100%;
  text-size-adjust: 100%;
}
hr {
  display: block;
  background-color: Gainsboro;
  height: 2px;
  margin: 1.5em 0;
  border: none;
}
p, dl, ol, ul, li, button, input, select, textarea, pre { margin: 0; }
p:not(:last-child), dl:not(:last-child), ol:not(:last-child), ul:not(:last-child),
blockquote:not(:last-child), pre:not(:last-child), table:not(:last-child) { margin-bottom: 1em; }
input[type=checkbox], input[type=radio] { margin: 0; vertical-align: baseline; }
strong, mark, table th, .table, .table thead td, .table thead th,
.table tfoot td, .table tfoot th { color: inherit; }
.image {
  display: block;
  position: relative;
}
.image img {
  display: block;
  height: auto;
  width: 100%;
}
.table {
  background-color: white;
//color: #363636;
  border-collapse: collapse;
  border-spacing: 0;
}
.table td, .table th {
  border: 1px solid #dbdbdb;
  border-width: 0 0 1px;
  padding: 0.5em 0.75em;
  vertical-align: top;
}
.table th { //color: #363636; }
.table th:not([align]) { text-align: inherit; }
.table thead { background-color: transparent; }
.table thead td, .table thead th {
  border-width: 0 0 2px;
//color: #363636;
}
.table tfoot { background-color: transparent; }
.table tfoot td, .table tfoot th {
  border-width: 2px 0 0;
//color: #363636;
}
.table tbody { background-color: transparent; }
.table tbody tr:last-child td,
.table tbody tr:last-child th { border-bottom-width: 0; }
.textarea {
  background-color: white;
  border-color: #dbdbdb;
  border-radius: 4px;
//color: #363636;
  display: block;
  max-width: 100%;
  min-width: 100%;
  padding: calc(0.75em - 1px);
  resize: vertical;
}
.textarea:not([rows]) {
  max-height: 40em;
  min-height: 8em;
}
.textarea[rows] { height: initial; }
.checkbox, .radio {
  cursor: pointer;
  display: inline-block;
  line-height: 1.25;
  position: relative;
}
.label {
//color: #363636;
  display: block;
//font-size: 14px; /* 1rem */
  font-weight: 700;
}
.label:not(:last-child) { margin-bottom: 0.5em; }
.field-label .label { font-size: inherit; }
.field-body .field .field,
.field-body .cfield .cfield { margin-bottom: 0; }
@media screen and (max-width: 719px) {
  .field-label { margin-bottom: 7px; /* 0.5rem */ }
}
@media screen and (min-width: 720px), print {
  .field.is-horizontal, .cfield.is-horizontal { display: flex; }
  .field-label {
    flex-basis: 0;
    flex-grow: 1;
    flex-shrink: 0;
    margin-right: 21px; /* 1.5rem */
    text-align: right;
  }
  .field-body {
    display: flex;
    flex-basis: 0;
    flex-grow: 5;
    flex-shrink: 1;
  }
  .field-body .field, .field-body .cfield { margin-bottom: 0; }
  .field-body > .field, .field-body > .cfield { flex-shrink: 1; }
  .field-body > .field:not(.is-narrow),
  .field-body > .cfield:not(.is-narrow) { flex-grow: 1; }
  .field-body > .field:not(:last-child),
  .field-body > .cfield:not(:last-child) { margin-right: 10.5px; /* 0.75rem */ }
}
.level {
  align-items: center;
  justify-content: space-between;
}
@media screen and (min-width: 720px), print {
  .level { display: flex; }
  .level > .level-item:not(.is-narrow) { flex-grow: 1; }
}
.level-item {
  align-items: center;
  display: flex;
  flex-basis: auto;
  flex-grow: 0;
  flex-shrink: 0;
  justify-content: center;
}
@media screen and (max-width: 719px) {
  .level-item:not(:last-child) { margin-bottom: 8px; } /* not Bulma */
  .level-item > .level { display: flex; }
}
.media {
  align-items: flex-start;
  display: flex;
  text-align: inherit;
}
.media + .media {
  border-top: 1px solid rgba(219, 219, 219, 0.5);
  margin-top: 14px; /* 1rem */
  padding-top: 14px; /* 1rem */
}
.media-left, .media-right {
  flex-basis: auto;
  flex-grow: 0;
  flex-shrink: 0;
}
.media-left { margin-right: 14px; /* 1rem */ }
.media-right { margin-left: 14px; /* 1rem */ }
.media-content {
  flex-basis: auto;
  flex-grow: 1;
  flex-shrink: 1;
  text-align: inherit;
}
@media screen and (max-width: 719px) {
  .media-content { overflow-x: auto; }
}
.tabs>ul, .tabs li {
  margin: 0;
  padding: 0;
  list-style: none;
}
.tabs {
  -webkit-overflow-scrolling: touch;
  align-items: stretch;
  display: flex;
//font-size: 1rem;
  justify-content: space-between;
  overflow: hidden;
  overflow-x: auto;
  white-space: nowrap;
}
.tabs a {
  align-items: center;
  border-bottom-color: #dbdbdb;
  border-bottom-style: solid;
  border-bottom-width: 1px;
//color: #4a4a4a;
  display: flex;
  justify-content: center;
  margin-bottom: -1px;
  padding: 0.5em 1em;
  vertical-align: top;
}
.tabs a:hover {
  border-bottom-color: #363636;
  color: #363636;
}
.tabs li { display: block; }
.tabs li.is-active a {
  border-bottom-color: #485fc7;
  color: #485fc7;
}
.tabs ul {
  align-items: center;
  border-bottom-color: #dbdbdb;
  border-bottom-style: solid;
  border-bottom-width: 1px;
  display: flex;
  flex-grow: 1;
  flex-shrink: 0;
  justify-content: flex-start;
}
.tabs .icon:first-child { margin-right: 0.5em; }
.tabs .icon:last-child { margin-left: 0.5em; }
.tabs.is-centered ul { justify-content: center; }
#nmwrap {
  font: normal 14px BlinkMacSystemFont, -apple-system, Helvetica, Arial, sans-serif;
  max-width: 960px;
  margin: 24px auto 96px;
  line-height: 1.5;
}
#nmwrap h4, #nmwrap h5 { margin-bottom: 7px; }
#nmwrap h4+h5 { margin-top: 14px; }
#nmwrap a {
  color: #485fc7;
  cursor: pointer;
  text-decoration: none;
}
#nmwrap a:hover {
  color: CornFlowerBlue;
}
#nmwrap .tabs a { color: DarkGrey; }
#nmwrap .tabs a:hover {
  border-bottom-color: #363636;
  color: #363636;
}
#nmwrap .tabs li.is-active a {
  border-bottom-color: #485fc7;
  color: #485fc7;
}
#nmwrap a:active, #nmwrap button:active { box-shadow: 0 0 0 0.125em rgb(50 152 220 / 25%); }
#nmwrap button, #nmwrap input:not([type=checkbox]), #nmwrap select {
  background: #f8f8f8;
  color: Grey;
//font-size: 14px;
  line-height: 0;
  height: 24px;
  margin: 0;
  padding: 0 8px;
  border: 0;
  border-radius: 0;
  vertical-align: bottom;
}
#nmwrap button, #nmwrap input[type=button], #nmwrap select {
  cursor: pointer;
  white-space: nowrap;
}
#nmwrap input::placeholder { opacity: 0.5; }
#nmwrap textarea { display: block; font: normal 10.5px monospace; width: 100%; }
#nmwrap .lnht1 { line-height: 1; }
#nmwrap .fsiz75 { font-size: 0.75em; }
#nmwrap .alnrt { text-align: right; }
#nmwrap .hwhsmk { background-color: Whitesmoke; }
#nmwrap .hgainl { background-color: #ececec; } /* Gainsboro #dcdcdc */
#nmwrap .hwarnl { background-color: #fff6e6; }
#nmwrap .hsuccl { background-color: #e8effc; }
#nmwrap .igreyd { color: DarkGrey; }
#nmwrap .ilink { color: #485fc7; }
#nmwrap .iwarn { color: Orange; }
#nmwrap .isucc, #nmwrap .ilink:hover { color: CornFlowerBlue; }
#nmwrap textarea.iwarn { color: unset; border-color: Orange; }
#nmwrap textarea.isucc { color: unset; border-color: CornFlowerBlue; }
#nmwrap button.opq0 {
  background: transparent;
  max-width: 359px;
  padding: 0 2px;
  overflow: hidden;
  text-overflow: ellipsis; }
#nmwrap button.bsml {
  height: 16px;
  padding: 4px;
}
#nmwrap .cblock:not(:last-child) { margin-bottom: 21px; }
#nmwrap .cfield:not(:last-child) { margin-bottom: 8px; }
#nmwrap .ccntr:not(:last-of-type) { margin-right: 8px; }
#nmwrap label.ccntr {
  display: inline-block;
  width: 126px;
  margin-right: 8px;
  line-height: 24px;
  text-align: right;
  white-space: nowrap;
}
#nmwrap label.ccntr+.ccntr>input[type=text],
#nmwrap label.ccntr+.ccntr>select { width: 216px; }
#nmwrap :not(.cfield)>.ccntr { display: inline-block; margin-bottom: 8px; }
#nmwrap .cfield .chelp { font-size: 12px; margin-top: 4px; line-height: 21px; }
#nmwrap .cfield .lnh14, #nmwrap .lnh14 { line-height: 1.4; }
#nmwrap .fltrt { float: right; }
#nmwrap .pwrap { word-wrap: normal; overflow-wrap: normal; white-space: pre-wrap; }
#nmwrap .mtup3 { margin-top: -3px; }
#nmwrap .mtup28 { margin-top: -28px; }
#nmwrap .mrt8 { margin-right: 8px; }
#nmwrap .dflow { display: flow-root; overflow-x: auto; }
#nmwrap .dnone { display: none; }
#nmwrap>#rsp2con {
  color: Orange;
  font: normal medium/1.25 monospace;
  margin: 0;
  padding: 0;
  word-wrap: normal;
  overflow-wrap: normal;
  overflow-x: hidden;
  white-space: pre;
}
#vctrls #pdbssel { width: 136px; }
#vctrls #ftotal { display: inline-block; min-width: 20px; }
#vctrls #viewsel { width: 24px; }
#vctrls #colssel, #vctrls #sortsel { width: 100px; }
#vctrls #descswi { margin-right: 2px; }
#vctrls #filtinp { width: 168px; }
#vctrls #moveinp { width: 114px; }
#nmtbl thead, #nmtbl tfoot { font-weight: bold; }
#nmtbl td:first-of-type { white-space: nowrap; }
#nmtbl td:nth-of-type(1), #nmtbl td:nth-of-type(2) { text-align: right; }
#nmtbl td[colspan="20"] {
  background: Whitesmoke;
  text-align: left;
}
#nmdata .cfield:not(:last-child) { margin-bottom: 10.5px; }
#nmdata .media-left>.image.rspv128 {
  width: 128px;
  height: unset;
  margin: 0 1em 0 2em;
}
#nmdata .media-left>.image img {
  background-color: LightSteelBlue;
  min-height: 128px;
  cursor: pointer;
}
#nmdata .media-left>.image>figcaption { font-style: italic; text-align: center; }
#nmdata .field-label>.label:not(:last-child),
#pnacnt .field-label>.label:not(:last-child) { margin-bottom: 0; }
#nmtabs li:first-child>a { letter-spacing: -3px; }
#pdbcfg .table {
  min-width: calc(238px + 30vw); /* 238/375px=63vw, 350/375px=93vw */
  margin-left: 8px;
}
#pdbcfg #pdbtbl td:nth-of-type(1),
#pdbcfg #t0tbod td:nth-of-type(1),
#pdbcfg #v0tbod td:nth-of-type(1) {
  width: 100px;
  max-width: 165px;
  overflow-x: clip;
  white-space: nowrap;
}
#pdbcfg #typtbl td { padding: 5.5px; }
#pdbcfg #typtbl td:nth-of-type(1)>input { width: 30vw; max-width: 120px; } /* 120/375px=32vw */
#pdbcfg #typtbl td:nth-of-type(2)>select { width: 84px; padding: 0 3px; } /* 84/375px=22vw */
#pdbcfg #typtbl td:nth-of-type(3)>input { width: 30vw; } /* 113/375px=30vw */
@media screen and (max-width: 575px) {
  #nmdata .media-left>.image.rspv128 { width: 48px; margin: 0; }
  #nmdata .media-left>.image.rspv128 img { min-height: 48px; }
  #nmdata .media-left>.image>figcaption { float: right; font-size: x-small; }
}
@media screen and (max-width: 719px) {
  #nmdata .media-left>.media-left>.image { margin: 0; }
  #nmdata .field-label>button.bsml, #pnacnt .field-label>button.bsml { margin: -16px 8px 0 0; }
}
@media screen and (min-width: 720px) and (max-width: 767px), print {
  #vctrls #pdbssel { width: 120px; }
  #vctrls #colssel, #vctrls #sortsel { width: 90px; }
  #vctrls #filtinp { width: 150px; }
  #vctrls #moveinp { width: 96px; }
}
</style>
<h4 class=cfield>Note Manager</h4>
<pre id=rsp2con></pre>
<nav id=vctrls class="level cblock">
  <div class="level-item">
    <div class="level cfield">
      <span class=ccntr><select id=pdbssel title="DB-open select list">
      </select></span><span class=ccntr><select id=viewsel title="Notelist-view select list">
        <option></option>
        <option>&plus; New Note</option>
        <option>&check;&thinsp;DB Config</option>
        <option>&#x2732; Settings</option>
        <option disabled>V1:noteclips</option>
        <option disabled>V2:organized</option>
        <option disabled>V3:mutables</option>
        <option disabled>V4:statics</option>
        <option disabled>V5:deleted</option>
      </select></span><span class=ccntr>Total: <span id=ftotal>_</span></span>
    </div>
  </div>
  <div class="level-item">
    <div class="level cfield">
      <span class=ccntr><select id=colssel multiple size=1 title="Show/hide-columns select list">
      </select></span><span class=ccntr><select id=sortsel title="Sort-column select list">
      </select></span><span class=ccntr><label title="Notelist sort order"><input type=checkbox id=descswi /><a>Z-A</a></label></span>
    </div>
  </div>
  <div class="level-item">
    <div class="level cfield">
      <span id=filtctrl class=ccntr>
      <input type=text id=filtinp placeholder="Search pattern&hellip;" /><button id=filtbtn class=hgainl title="Notelist filter">
      FILT</button></span><span id=bulkctrl class="ccntr dnone"><span class=cfield>
      <span class=ccntr><input type=text id=moveinp placeholder="New subdir&hellip;" /><button id=movebtn class="isucc hsuccl" title="Note subdirectory reassignment">
      MOV</button></span><span class=ccntr><button id=delbtn class="iwarn hwarnl" title="Note delete">
      DEL</button></span></span></span><span class=ccntr><a id=blktrig title="Checkboxes toggle">&#x2611;</a></span>
    </div>
  </div>
</nav>
<div id=nmflow class="cblock dflow dnone">
<table id=nmtbl class=table>
  <thead>
    <tr>
      <td>
        <span>#</span><a class=dnone>&#x25b6;</a>
        <input type=checkbox class=dnone />
      </td>
      <td>Subdir</td>
      <td>Note ID</td>
      <td>Type</td>
      <td>Updated</td>
      <td>Up'd By</td>
      <td>Up'd Ver</td>
      <td>Up'd Misc</td>
      <td>Created</td>
      <td>Cr'd By</td>
      <td>Cr'd Ver</td>
      <td>Cr'd Misc</td>
      <td>People</td>
      <td>Username</td>
      <td>Image</td>
      <td>Link Ref</td>
      <td>From</td>
      <td>To</td>
      <td>Subject</td>
      <td>Headline</td>
      <td>Time</td>
      <td>Place</td>
      <td>Attach's</td>
    </tr>
  </thead>
  <thead class=dnone>
    <tr>
      <td># <input type=checkbox class=dnone /></td>
      <td>Chg Seq</td>
      <td>Note ID</td>
      <td>Revision#</td>
    </tr>
  </thead>
  <tbody></tbody>
  <tfoot>
    <tr>
      <td>
        <span>#</span><a class=dnone>&#x25b6;</a>
        <input type=checkbox class=dnone />
      </td>
      <td>Subdir</td>
      <td>Note ID</td>
      <td>Type</td>
      <td>Updated</td>
      <td>Up'd By</td>
      <td>Up'd Ver</td>
      <td>Up'd Misc</td>
      <td>Created</td>
      <td>Cr'd By</td>
      <td>Cr'd Ver</td>
      <td>Cr'd Misc</td>
      <td>People</td>
      <td>Username</td>
      <td>Image</td>
      <td>Link Ref</td>
      <td>From</td>
      <td>To</td>
      <td>Subject</td>
      <td>Headline</td>
      <td>Time</td>
      <td>Place</td>
      <td>Attach's</td>
    </tr>
  </tfoot>
  <tfoot class=dnone>
    <tr>
      <td># <input type=checkbox class=dnone /></td>
      <td>Chg Seq</td>
      <td>Note ID</td>
      <td>Revision#</td>
    </tr>
  </tfoot>
</table>
</div>
<div id=nmdata class="cblock dnone"></div>
<nav id=nmtabs class="cblock tabs">
  <ul>
    <li data-tabidx=0 class="is-active">
      <a>&blk14;&blk14;</a>
    </li>
    <li data-tabidx=1>
      <a><span class=icon>&plus;</span><span>New Note</span></a>
    </li>
    <li data-tabidx=2>
      <a><span class=icon>&check;</span><span>DB Config</span></a>
    </li>
    <li data-tabidx=3>
      <a><span class=icon>&#x2732;</span><span>Settings</span></a>
    </li>
  </ul>
</nav>
<div id=nmtips class=cblock>
  <h4>Just getting started?</h4>
  <p>
    &emsp;Add a new <em>database</em> ( <span class=hwhsmk>&plus; New DB</span> )
    using the 1<sup>st</sup> select list of the control panel&nbsp;above.
  </p>
</div>
<div id=pnadd1 class="cblock dnone">
  <div id=pnahlp>
    <h4>New Note</h4>
    <p>
      &emsp;<em>Use Tip:</em> You must first create/open a database before you can add a new <em>note</em>.
    </p>
  </div>
  <div id=pnacnt class=dnone></div>
</div>
<div id=pdbcfg class="cblock dnone">
  <label class="fltrt mtup3 fsiz75 lnht1 ilink"><input type=checkbox id=cfgcbx checked />
  Show<br />use guides</label>
  <h4>Database Setup &plus; Configuration</h4>
  <h5>Old Data Destruction</h5>
  <p>
    &emsp;To <em>destroy</em> an existing database&mdash;or to <em>compact</em> it
    (i.e., remove all versions of each <em>note</em> but the last one)&mdash;enter
    the same name as the currently selected database and tap the appropriate button, here.
  </p>
  <div id=olddctrl class=cblock>
    <div class=cfield>
      <div class=chelp><em>Alert:</em> This operation cannot be reversed.</div>
      <label class=ccntr>Selected DB name</label><span class=ccntr><input type=text id=ddelinp /></span>
    </div>
    <div class=cfield>
      <label class=ccntr>
      </label><span class=ccntr><button id=dbd0btn class="isucc hsuccl">
      COMPACT</button></span><span class=ccntr><button id=dbd1btn class="iwarn hwarnl">
      DESTROY</button></span>
      <div class="chelp isucc dnone">Old data destruction is successful.</div>
      <div class="chelp iwarn dnone">Old data destruction failed.</div>
    </div>
  </div>
  <h5>New Database Creation</h5>
  <p>
    &emsp;To <em>create</em> a new local database, enter your username,
    a new DB name and a short description of its intended purpose;
    (And, optionally, set your own DB configurations, below;)
    Then, tap the associated button, here.
  </p>
  <div class=cblock>
    <div class=cfield>
      <label class=ccntr>Username</label><span class=ccntr><input type=text id=una2inp /></span>
    </div>
    <div class=cfield>
      <label class=ccntr>New DB name</label><span class=ccntr><input type=text id=pdb0inp /></span>
    </div>
    <div class=cfield>
      <label class=ccntr>DB description</label><span class=ccntr><input type=text id=pdb1inp /></span>
    </div>
    <div class=cfield>
      <label class=ccntr>
      </label><span class=ccntr><button id=pdb0btn class="isucc hsuccl">CREATE</button></span>
      <div class="chelp isucc dnone">New DB creation is successful.</div>
      <div class="chelp iwarn dnone">New DB creation failed.</div>
    </div>
  </div>
  <hr />
  <h4>About the Selected, Local DB</h4>
  <p>
    &emsp;You can switch to any previously created, local database by using
    the 1<sup>st</sup> select list of the top control&nbsp;panel.
  </p>
  <table id=pdbtbl class="table cfield">
    <tbody>
      <tr><td>DB name:</td><td id=pdbnam></td></tr>
      <tr><td>Notes total:</td><td id=pdbtot></td></tr>
      <tr><td>Update seq#:</td><td id=pdbseq></td></tr>
      <tr><td>Created:</td><td></td></tr>
      <tr><td>Created by:</td><td></td></tr>
      <tr><td>Description:</td><td></td></tr>
    </tbody>
  </table>
  <div class="cfield lnh14">
    &emsp;<label><input type=checkbox id=opencbx disabled /> <a>Set as default DB</a></label>
    <br />&emsp;&emsp; <span class=chelp>(Open this DB directly on next startup.)</span>
  </div>
  <h5>"New Note" Type/Template</h5>
  <p>
    &emsp;You can add a new <em>note</em> ( <span class=hwhsmk>&plus; New Note</span> ) to the database by using the 2<sup>nd</sup> select list of the top control panel (or, by activating the corresponding tab beneath the notelist <em>view</em>).
  </p>
  <p>
    &emsp;Be aware that a database <em>note</em>
    (a.k.a., <em>file</em> or <em>document</em> or <em>entry</em>) is actually
    a stored JavaScript object (with arbitrary <em>keys</em> and <em>values</em>).
  </p>
  <p>
    &emsp;As such, the database is more manageable when all of its <em>notes</em>
    share a common structure (i.e., have the same set of object-property <em>keys</em>).
  </p>
  <p>
    &emsp;Therefore, to keep a new database manageable, decide in advance
    what its function is by committing to one object structure as the default template for
    every new <em>note</em>&mdash;and selecting it (either a preset <em>note</em> type
    or a new creation of your own), here.
  </p>
  <div class=cfield>
    <label class=ccntr>Default note type</label><span class=ccntr><select id=t00sel></select></span>
  </div>
  <table id=typtbl class="cfield table">
    <thead>
      <tr><th>Note-object-<br />property KEY</th>
      <th>VALUE<br />datatype</th><th>VALUE<br />pre-fill</th></tr>
    </thead>
    <tbody id=t1tbod></tbody>
  </table>
  <pre class=dnone>
   Note-obj-pty KEY | VALUE datatype| VALUE pre-fill
   _id              | string        | `cidGen()`
   file_type        | string        | contact
   ts_created       | number        | `Date()`
   ts_updated       | number        | `Date()`
   name_full        | string        |
   name_user        | string        |
   birthdate        | string        |
   roles            | string        |
   emails           | arr of str    | []
   phones           | arr of str    | []
   locations        | arr of obj    | [ { "label": "home", "street": "", ... } ]
   social_profiles  | arr of str    | []
   project_urls     | arr of str    | []
   team_groups      | arr of str    | []
   image_src        | string        |
   bio_short        | string        |
   miscellany       | string        |
  </pre>
  <div class=cfield>
    <label class=ccntr>Custom type label</label><span class=ccntr><input type=text id=t01inp /></span>
  </div>
  <div class=cfield>
    <label class=ccntr>Type description</label><span class=ccntr><input type=text id=t02inp /></span>
  </div>
  <div class=cfield>
    <label class=ccntr>
    </label><span class=ccntr><button id=t0abtn class=hgainl><span class=isucc>&plus;</span>
    NEW TYPE</button></span>
    <div class="chelp isucc dnone">Add-new-type operation is successful.</div>
    <div class="chelp iwarn dnone">Add-new-type operation failed.</div>
  </div>
  <table class="cfield table">
    <tbody id=t0tbod></tbody>
  </table>
  <div class=cfield>
    <label class=ccntr>
    </label><span class=ccntr><button id=t0dbtn class=hgainl><span class=iwarn>&#x2715;</span>
    DEL TYPE</button></span>
    <div class="chelp isucc dnone">Delete-type operation is successful.</div>
    <div class="chelp iwarn dnone">Delete-type operation failed.</div>
  </div>
  <h5>Notelist Views</h5>
  <p>
    &emsp;You can switch to any notelist <em>view</em> by using the 2<sup>nd</sup> select list of the top control panel.
  </p>
  <p>
    &emsp;Five different <em>views</em> are available (<span class=hwhsmk>V1</span>&ndash;<span class=hwhsmk>V5</span>).
  </p>
  <p>
    &emsp;Customize and preserve any one or more of the five <em>views</em> by selecting one and
    adjusting the subsequent view controls, above&mdash;then, returning directly back here to add
    the resulting new <em>view</em>, below.
  </p>
  <p>
    &emsp;Also, select one (either a preset or one of your own) as the default <em>view</em>&mdash;i.e.,
    the <em>view</em> that will be displayed first each time the database is opened.
  </p>
  <div class=cblock>
    <div class=cfield>
      <label class=ccntr>Default <em>view</em></label><span class=ccntr><select id=v00sel></select></span>
    </div>
  </div>
  <div class=cfield>
    <label class=ccntr>Custom <em>view</em> label</label><span class=ccntr><input type=text id=v01inp /></span>
  </div>
  <div class=cfield>
    <label class=ccntr><em>View</em> description</label><span class=ccntr><input type=text id=v02inp /></span>
  </div>
  <div class=cfield>
    <label class=ccntr>
    </label><span class=ccntr><button id=v0abtn class=hgainl><span class=isucc>&plus;</span>
    NEW VIEW</button></span>
    <div class="chelp isucc dnone">Add-new-view operation is successful.</div>
    <div class="chelp iwarn dnone">Add-new-view operation failed.</div>
  </div>
  <table class="cfield table">
    <tbody id=v0tbod></tbody>
  </table>
  <div class=cfield>
    <label class=ccntr>
    </label><span class=ccntr><button id=v0dbtn class=hgainl><span class=iwarn>&#x2715;</span>
    DEL VIEW</button></span>
    <div class="chelp isucc dnone">Delete-view operation is successful.</div>
    <div class="chelp iwarn dnone">Delete-view operation failed.</div>
  </div>
</div>
<div id=nmsets class="cblock dnone">
  <label class="fltrt mtup3 fsiz75 lnht1 ilink"><input type=checkbox id=setcbx />
  Show<br />use guides</label>
  <h4><em>Note Mgr</em> App Settings</h4>
  <p class=dnone>
    &emsp;For convenience, choose a default database, and associated <em>view</em>, that will be directly opened and displayed at each&nbsp;startup.
  </p>
  <p class=dnone>
    &emsp;Also, optionally, identify yourself by username and/or email, which will be associated with every database that you create. This becomes useful if, for example, your DB data is ever synced to a cloud server and/or consolidated with other users' data; User identities facilitate a team's management of multiple&nbsp;DBs.
  </p>
  <div class=cblock>
    <div class=cfield>
      <label class=ccntr>Default DB</label><span class=ccntr><select id=opensel></select></span>
    </div>
    <div class=cfield>
      <label class=ccntr>Default <em>view</em></label><span class=ccntr><select id=v0ssel></select></span>
    </div>
    <div class=cfield>
      <label class=ccntr>Username</label><span class=ccntr><input type=text id=unaminp /></span>
    </div>
    <div class=cfield>
      <label class=ccntr>User email</label><span class=ccntr><input type=text id=uemlinp /></span>
    </div>
  </div>
  <hr />
  <h4>Wipe user data stored on device</h4>
  <p class=dnone>
    &emsp;App settings and DB configurations are stored in the browser's <em>Local&nbsp;Storage</em>.
  </p>
  <p class=dnone>
    &emsp;Each database's collection of notes is stored in the browser's <em>IndexedDB&nbsp;Storage</em>.
  </p>
  <p class=dnone>
    &emsp;Be aware that these data stores are not secure; They may be viewed by any prying person who is allowed access to the device, even without the use of the <em>Note&nbsp;Mgr</em>&nbsp;app.
  </p>
  <p class=dnone>
    &emsp;To completely destroy either one or both stores of user data, select the appropriate checkbox(es), enter the same username as above and tap the associated button, here.
  </p>
  <p class=dnone>
    &emsp;<em>Use Tip:</em> To destroy just one DB without affecting any other DB, use the <em class=hwhsmk>DB Config</em> control panel instead.
  </p>
  <div id=wipectrl class=cblock>
    <div class=cfield>
      <div class=chelp><em>Alert:</em> This operation cannot be reversed.</div>
      &emsp;<label class=iwarn><input type=checkbox /> Empty local storage</label>
      <br />&emsp;<label class=iwarn><input type=checkbox /> Purge all local DBs</label>
    </div>
    <div class=cfield>
      <label class=ccntr>Username</label><span class=ccntr><input type=text id=wipeinp /></span>
    </div>
    <div class=cfield>
      <label class=ccntr>
      </label><span class=ccntr><button class="iwarn hwarnl">
      WIPE DATA</button></span>
      <div class="chelp isucc dnone">Data wipe is successful.</div>
      <div class="chelp iwarn dnone">Data-wipe attempt failed.</div>
    </div>
  </div>
  <hr />
  <h4>Browser Command UI</h4>
  <p class=dnone>
    &emsp;<em>How it works:</em>
    The "<code>&gt;</code>" symbol in the following text field is a <em>command prompt</em>. The prompt accepts any JavaScript command or expression. When a command or an expression is entered on the <em>command line</em> (i.e., after the prompt) and the field is de-focused (by tapping outside the field), the command or expression is executed by the browser and the final result is then displayed in the next line(s) of the text field.
  </p>
  <span class="fltrt mtup28 mrt8"><button id=jselbtn class="bsml ilink" data-seltrg=jsctxta>sel</button></span>
  <div class=cblock>
    <textarea id=jsctxta class=textarea rows=31>&gt; </textarea>
  </div>
</div>
</div>

<script src="../../a00/-res-js/pouchdb.min.js" type="text/javascript"></script>
<script src="../../a00/-res-js/pouchdb.all-dbs.min.js" type="text/javascript"></script>
<script type=module>
let fwg, nm0cfgs, nm0sets, rva2, rval, vbas, vusr,
  j = 0,  tidx = 0, vidx = 0,
  txd1 = {
    DBNAME:  "",
    FILEID:  "_design/ecosorter",
    VIEW:    "files-idxlist",
    OPTIONS: { since: 0 }
  },
  copts = [`
          <option value="loc_subdir || (file_updated || file_created).subdir">Subdir</option>
          <option value="id">Note ID</option>
          <option value="file_type">Type</option>
          <option value="file_updated.timestamp">Updated</option>
          <option value="file_updated.username">Up'd By</option>
          <option value="file_updated.version">Up'd Ver</option>
          <option value="file_updated.misc || file_updated.notes">Up'd Misc</option>
          <option value="file_created.timestamp">Created</option>
          <option value="file_created.username">Cr'd By</option>
          <option value="file_created.version">Cr'd Ver</option>
          <option value="file_created.misc || file_created.notes">Cr'd Misc</option>
          <option value="people">People</option>
          <option value="name_user">Username</option>
          <option value="image_src">Image</option>
          <option value="linkref">Link Ref</option>
          <option value="from">From</option>
          <option value="to">To</option>
          <option value="subject">Subject</option>
          <option value="headline">Headline</option>
          <option value="time">Time</option>
          <option value="place">Place</option>
          <option value="_attachments">Attach's</option>
        `, `
          <option value="seq">Chg Seq</option>
          <option value="id">Note ID</option>
          <option value="rev">Revision#</option>
        `],
  qslrs = [
    '#vctrls #colssel>option:nth-of-type(2), '
    + '#nmtbl thead:first-of-type td:nth-of-type(3), '
    + '#nmtbl tfoot:first-of-type td:nth-of-type(3)',
    '#nmtbl thead:first-of-type td:first-of-type>span, '
    + '#nmtbl tfoot:first-of-type td:first-of-type>span',
    '#nmtbl thead:first-of-type td:first-of-type>a, '
    + '#nmtbl tfoot:first-of-type td:first-of-type>a',
    '#nmtbl thead:not(.dnone) td:first-of-type>input, '
    + '#nmtbl tfoot:not(.dnone) td:first-of-type>input',
    '#nmtbl thead:not(.dnone) td:first-of-type>input, '
    + '#nmtbl tbody>tr>td:first-of-type>input, '
    + '#nmtbl tfoot:not(.dnone) td:first-of-type>input',
    '#nmdata .media-left figcaption,'
    + '#nmdata .media-content>.pwrap>strong,'
    + '#nmdata .media-content>.pwrap>em,'
    + '#nmdata .media-content>.pwrap>details'
  ],
  nmthds = document.querySelectorAll('#nmtbl thead'),
  nmtbod = document.querySelector('#nmtbl tbody'),
  nmtfts = document.querySelectorAll('#nmtbl tfoot'),
  tabncs = document.querySelectorAll('#nmtabs li>a'),
  nmpans = [nmtips, pnadd1, pdbcfg, nmsets],
  actrls = [opencbx, opensel, v0ssel, unaminp, uemlinp],
  pntyps = {
    new: {
      _id: "",
      _rev: ""
    },
    srcdoc: {
      _id: "",
      _rev: "",
      file_type: "srcdoc",
      file_created: {
        username: "",
        timestamp: 0,
        dborigin: "",
        dbname: "",
        subdir: "",
        misc: ""
      },
      file_updated: {
        username: "",
        timestamp: 0,
        dborigin: "",
        dbname: "",
        subdir: "",
        misc: ""
      },
      media_type: "text/plain",
      content: ""
    },
    scrap: {
      _id: "",
      _rev: "",
      file_type: "scrap",
      ts_created: 0,
      ts_updated: 0,
      loc_subdir: "",
      content: ""
    },
    event: {
      _id: "",
      _rev: "",
      file_type: "event",
      file_created: {
        username: "",
        timestamp: 0,
        dborigin: "",
        dbname: "",
        subdir: ""
      },
      file_updated: {
        username: "",
        timestamp: 0,
        dborigin: "",
        dbname: "",
        subdir: ""
      },
      people: [""],
      headline: "",
      time: "",
      place: "",
      map_refs: [""],
      description: "",
    },
    memo: {
      _id: "",
      _rev: "",
      file_type: "memo",
      file_created: {
        username: "",
        timestamp: 0,
        dborigin: "",
        dbname: "",
        subdir: ""
      },
      linkref: "",
      from: "",
      to: [""],
      subject: "",
      body: ""
    },
    contact: {
      _id: "",
      _rev: "",
      file_type: "contact",
      ts_created: 0,
      ts_updated: 0,
      loc_subdir: "",
      name_full: "",
      name_user: "",
      birthdate: "",
      roles: [""],
      emails: [""],
      phones: [""],
      locations: [
        {
          label: "home",
          street: "",
          city: "",
          state: "",
          zip: ""
        }
      ],
      social_profiles: [""],
      project_urls: [""],
      team_groups: [""],
      image_src: "",
      bio_short: "",
      miscellany: ""
    }
  },
  rsp2Show = r => rsp2con.textContent
    += ( !r || typeof r !== 'object' || r instanceof Error && r.constructor && !r.reason
      ? r : JSON.stringify(r, null, 2) ) + "\n\n",
  fncTry = (a, fnc, e) => { try { return fnc(a) } catch (err) { return e ? err : undefined }},
  vtoStr = (v, sp) => v == null ? ""
    : v instanceof Error && v.constructor && !v.reason ? v
    : typeof v === 'object' ? JSON.stringify(v, null, sp)
    : typeof v !== 'string' ? "" + v
    : !/^{\s*['"][^]+}$|^\[[^]+\]$/.test(v.trim()) ? v
    : JSON.stringify(fncTry(v, JSON.parse), null, sp) || v,
  jscEval = () => {
    let fncexp = jsctxta.value.trim().replace(/(?:[^]*\n|^)>\s*(?=(?:.|\n(?!>))*$)/, ""),
      rsltShow = r => jsctxta.value += "\n" + vtoStr(r, 2) + "\n> ";
    !fncexp || Promise.resolve(fncTry(fncexp, window.eval, 1)).then(rsltShow).catch(rsltShow);
  },
  txtaSel = e => !(e.focus || (e = window.eval(e.target.dataset.seltrg)))
    || e.focus() || e.setSelectionRange(0, e.textLength),
  ordFlip = arr => !descswi.checked ? arr.sort() : arr.sort().reverse(),
  aurlGen = isrc => isrc,
  date0Fmt = nbr => !nbr ? "" : new Date(nbr).toISOString().replace(/T.+$/, ""),
  date1Fmt = str => !str ? ""
    : new Date(str).toUTCString().replace(/.+(\d{2} [a-z]{3} \d{4}).+/i, "$1"),
  tr0Gen = (r, i) => `
    <tr${ vbas !== 2 ? "" : " hidden"}>
      <td>${ 1 + i - j } <input type=checkbox class=dnone /></td>
      <td>${ (rval = r.doc || r.value).file_updated
        ? (rval.file_updated.subdir || ".") + "/" : "" }</td>
      <td>${ rval._id || r.id }</td>
      <td>${ (rval.file_type || "").replace(/^eco-/, "")
        || (!/^[.-]./.test(rval._id || r.id) ? "" : "(app assets)") }</td>
      <td>${ date0Fmt(rval.ts_updated
        || rval.file_updated && rval.file_updated.timestamp) }</td>
      <td>${ rval.file_updated && rval.file_updated.username || "" }</td>
      <td>${ rval.file_updated && rval.file_updated.version || "" }</td>
      <td>${ rval.file_updated && (rval.file_updated.notes || rval.file_updated.misc) || "" }</td>
      <td>${ date0Fmt(rval.ts_created
        || rval.file_created && rval.file_created.timestamp) }</td>
      <td>${ rval.file_created && rval.file_created.username || "" }</td>
      <td>${ rval.file_created && rval.file_created.version || "" }</td>
      <td>${ rval.file_created && (rval.file_created.notes || rval.file_created.misc) || "" }</td>
      <td>${ (rval.people || rval.contributors || []).join(", ") || "" }</td>
      <td>${ rval.name_user || "" }</td>
      <td>${ rval.image_src || "" }</td>
      <td>${ rval.linkref || "" }</td>
      <td>${ rval.from || "" }</td>
      <td>${ (rval.to || []).join(", ") || "" }</td>
      <td>${ rval.subject || "" }</td>
      <td>${ rval.headline || "" }</td>
      <td>${ rval.time || "" }</td>
      <td>${ rval.place || "" }</td>
      <td>${ Object.keys(rval._attachments || "").length || "" }</td>
    </tr>`,
  qd2Fmt = rows => rows.map( (r, i) =>
    !(rval = r.doc || r.value)._attachments && /^\./.test(r.id) ? ""
    : /^[.-]/.test(r.id) ? (!i || (j = i)) && `
    <tr id="${ r.id.replace(/^[.-]/, "_") }">
      <td colspan=20><a>&#x25b6;</a> <input type=checkbox class=dnone /> ${
        r.id.replace( /^[.-].+$/, m => m + " ("
          + (/^eco-assets$/.test(rval.file_type || "") ? "eco-" : "app ") + "assets)" ) }</td>
    </tr>\n` + ordFlip(Object.keys(rval._attachments || "")).map( (k, i2) => `
    <tr hidden>
      <td>${ 1 + i2 } <input type=checkbox class=dnone /></td>
      <td>${ r.id + "/" }</td>
      <td colspan=18>${ !rval._attachments[k] ? k
        : k + " (" + Math.ceil(+rval._attachments[k].length / 1000) + "k)" }</td>
    </tr>` ).join("")
    : !i || !(rva2 = rows[i - 1].doc || rows[i - 1].value).file_updated
      || rval.file_updated.subdir !== rva2.file_updated.subdir
    ? (!i || (j = i)) && `
    <tr id="${ rval.file_updated.subdir || "_" }">
      <td colspan=20><a>&#x25b6;</a> <input type=checkbox class=dnone /> ${
        rval.file_updated.subdir || "/" }</td>
    </tr>` + tr0Gen(r, i)
    : tr0Gen(r, i) ).join("") + "\n  ",
  qd3Fmt = rows => rows.map(tr0Gen).join("") + "\n  ",
  qd5Fmt = dels => dels.map( (d, i) => `
    <tr>
      <td>${ 1 + i } <input type=checkbox class=dnone /></td>
      <td>${ d.seq }</td>
      <td>${ d.id }</td>
      <td>${ d.changes[0].rev }</td>
    </tr>` ).join("") + "\n  ",
  blk2Tog = () => {
    if (vbas === 5) { return; }
    let chks = vbas !== 1
        ? document.querySelectorAll('#nmtbl tbody>tr:not([id])>td:first-of-type>input:checked')
        : document.querySelectorAll('#nmdata .media-content>.pwrap>span>input:checked');
    (chks.length ? filtctrl : bulkctrl).classList.add("dnone");
    (chks.length ? bulkctrl : filtctrl).classList.remove("dnone");
  },
  bulkTog = () => {
    let hid = vbas !== 1
        ? document.querySelector('#nmtbl thead:not(.dnone) td:first-of-type>input.dnone')
        : document.querySelector('#nmdata .media-content>.pwrap>span.dnone');
    ( vbas !== 1 ? document.querySelectorAll(qslrs[4])
      : document.querySelectorAll('#nmdata .media-content>.pwrap>span') )
      .forEach(e => e.className = hid ? "" : "dnone");
    if (hid) {
      blk2Tog();
    } else {
      bulkctrl.classList.add("dnone");
      filtctrl.classList.remove("dnone");
    }
  },
  filtExe = () => {
    let negs = /^-/.test(filtinp.value),
      sepa = /^\/.+\/[gim]*$/.test(filtinp.value.trim()) ? eval(filtinp.value)
        : new RegExp(filtinp.value.replace(/^-/, "") || "^$", "gi");
    rsp2con.textContent = "";
    //vbas === 1 || (nmdata.innerHTML = "");
    ( vbas !== 1 ? document.querySelectorAll(qslrs[4])
      : document.querySelectorAll('#nmdata .media-content>.pwrap>span>input') )
      .forEach(inp => inp.checked = false);
    document.querySelectorAll('#nmtbl tbody>tr:not([id])').forEach(tr => {
      tr.classList.remove("dnone", "match");
      Array.from(tr.children)
      .forEach( (td, i) => !i || ( (i !== 2 ? td : td.firstChild).innerHTML
        = (i !== 2 ? td : td.firstChild).innerHTML.replace(/<\/?mark>/g, "") ));
    });
    document.querySelectorAll(qslrs[5])
    .forEach(e => e.innerHTML = e.innerHTML.replace(/<\/?mark>/g, ""));
    document.querySelectorAll('#nmdata .media').forEach(e => e.classList.remove("dnone"));
    if (vbas !== 1 && filtinp.value) {
      document.querySelectorAll('#nmtbl tbody>tr:not([id]):not([hidden])')
      .forEach( tr => Array.from(tr.children).forEach( (td, i) => {
        if (i && !td.classList.contains("dnone")) {
          sepa.lastIndex = 0;
          !negs ? tr.classList.contains("match")
            || (tr.className = sepa.test(td.textContent) ? "match" : "dnone")
          : tr.classList.contains("dnone")
            || (tr.className = !sepa.test(td.textContent) ? "match" : "dnone");
          negs || ( (i !== 2 ? td : td.firstChild).innerHTML
            = (i !== 2 ? td : td.firstChild).innerHTML.replace(sepa, "<mark>$&</mark>") );
        }
      }));
    } else if (filtinp.value) {
      document.querySelectorAll(qslrs[5])
      .forEach(e => e.innerHTML = e.innerHTML.replace(sepa, "<mark>$&</mark>"));
      document.querySelectorAll('#nmdata .media')
      .forEach(e => /<mark>/.test(e.innerHTML) != negs || e.classList.add("dnone"));
    }
  },
  filesChg = evt => {
    if (vbas === 5) { return; }
    let fmove = evt.target.id === "movebtn",
      //qcontxta = document.querySelector('#econav0 #qcontxta'),
      moveinp = document.querySelector('#nmwrap #moveinp'),
      chks = document.querySelectorAll('#nmtbl tbody>tr:not([id])>td:first-of-type>input:checked'),
      chkaf2 = !fmove ? Array.from(chks)
          .filter(inp => !/^[.-]\w/.test(inp.parentElement.parentElement.children[1].textContent))
        : Array.from(chks).filter( inp => inp.parentElement.parentElement.children[3]
          && /^(?:anno|memo|post|prjid|publmgr|srcdoc)$/
          .test(inp.parentElement.parentElement.children[3].textContent) ),
      txd2 = {
        DBNAME:  txd1.DBNAME,
        FILEID:  "_all_docs",
        OPTIONS: {
          keys: chkaf2.map(inp => inp.parentElement.parentElement.children[2].textContent),
          include_docs: fmove
        }
      },
      row1Tfm = r1 => {
        !fmove || !r1 || !r1.doc
        || ((r1.doc.file_updated || r1.doc.file_created || "").subdir = moveinp.value || "");
        return fmove ? Object.assign({ _id: "", _rev: null }, (r1 || "").doc)
        : {
            _id:  r1.key || r1.id,
            _rev: r1.value && r1.value.rev || r1.changes && r1.changes[0].rev,
            _deleted: true
          }
      },
      rdataTfm = rslt => !rslt.rows && !rslt.results ? {} : {
        DBNAME: txd2.DBNAME,
        docs:   (rslt.rows || rslt.results).map(row1Tfm) //.filter(d => !d._deleted)
      },
      dbq = txd2.DBNAME && window.PouchDB && new PouchDB(txd2.DBNAME);
    rsp2con.textContent = "";
    //vbas === 1 || (nmdata.innerHTML = "");
    !fmove || Array.from(chks).forEach(inp => inp.parentElement.parentElement.className = "");
    chkaf2.forEach( inp => inp.parentElement.parentElement.className
      = fmove ? "hsuccl" : "hwarnl" );
    !dbq || ( txd2.FILEID === "_all_docs"
      ? dbq.allDocs(txd2.OPTIONS).then(rdataTfm).then(rsp2Show)
      : txd2.FILEID === "_changes"
      ? dbq.changes(txd2.OPTIONS).then(rdataTfm).then(rsp2Show)
      : dbq.get(txd2.FILEID, txd2.OPTIONS).then(rsp2Show) )
    .catch(rsp2Show);
  },
  fileLoad = evt => {
    let txd2 = {
        DBNAME:  txd1.DBNAME,
        FILEID:  !evt ? "" : evt.target.textContent || evt.target.dataset.fileid,
        OPTIONS: {
          rev: vbas !== 5 ? null : evt.target.parentElement.parentElement.children[3].textContent
          //revs_info: true
        }
      };
    rsp2con.textContent = "";
    !txd2.DBNAME || !window.PouchDB || new PouchDB(txd2.DBNAME)
    .get(txd2.FILEID, txd2.OPTIONS).then(doc => {
      let lnl, str,
        txtaHt = k => ( lnl = ( ( str = vtoStr( fwg[k],
              !Array.isArray(fwg[k]) || typeof fwg[k][0] === 'object' ? 2 : null ))
            .match(/\n/g) || "" ).length ) > 8 || str.length > 400
          ? 16 : lnl > 2 || str.length > 200 ? 8 : 2;
      fwg = doc;
      [vctrls, nmflow, nmtabs, nmpans[tidx]].forEach(e => e.classList.add("dnone"));
      nmdata.classList.remove("dnone");
      nmdata.innerHTML = "\n<div class=cfield>\n<span class=fltrt>"
      + "<button id=updbtn class=hgainl><span class=isucc>&#x267a;</span> UPDATE</button></span>"
      + "\n<button id=bckbtn class=hgainl><strong class=ilink>&lang;</strong></button>"
      + " <button class=opq0 disabled>" + txd2.DBNAME + " &sol;</button>"
      + ( !(fwg.file_updated || "").subdir ? ""
        : "<button class=opq0 disabled>" + fwg.file_updated.subdir + " &sol;</button>" )
      + "<button class=opq0 disabled>" + fwg._id + "</button>"
      + "\n<div class=\"chelp isucc alnrt lnh14 dnone\">Note is updated in local DB.</div>"
      + "\n<div class=\"chelp iwarn alnrt lnh14 dnone\">Note-update attempt failed.</div>\n</div>"
      + Object.keys(fwg).map(k => /^_id$|^_rev$/.test(k) ? "" : `
<div class="cfield is-horizontal">
  <div class="field-label">
    <span class=label>${k}</span>
    <button class="fltrt bsml ilink" data-seltrg=${"p0" + k}>sel</button>
  </div>
  <div class="field-body">
    <textarea id=${"p0" + k} class=textarea rows=${txtaHt(k)}>${
      str.replace(/&(?=#?\w+;)/g, "&amp;").replace(/<(?=[!/?a-z])/gi, "&lt;")}</textarea>
  </div>
</div>`).join("") + "\n";
      bckbtn.onclick = () => (fwg = null) || [vctrls, nmtabs, nmpans[tidx]]
        .forEach(e => e.classList.remove("dnone")) || viewChg(); //viewBk
      updbtn.onclick = () => {
        let hlps = nmdata.querySelectorAll('.chelp');
        hlps.forEach(e => e.classList.add("dnone"));
        hlps[0].classList.remove("dnone");
      }; //fwgUpd;
      nmdata.querySelectorAll('.field-label button').forEach(e => e.onclick = txtaSel);
    }).catch(rsp2Show);
    //rsp2Show(txd2);
/*
    /^[.-]\w/.test(td1txt)
    ? !window.EC1 || !attlist
      || (attlist.value = td1txt + evt.target.textContent.replace(/ \(\d+k\)$/, ""))
      && EC1.attSel()
    : fwinflux || !qcontxta
      || (qcontxta.value = JSON.stringify(txd2, null, 2)); //|| !window.EC2 ...&& EC2.qconRetrvD();
*/
  },
  vwFnlz = evt => {
    if (vidx > 8 && (!evt || evt.target.id === "viewsel")) {
      !(nm0sets.p2vws[vusr] || "").cbxs || bulkTog();
      !(filtinp.value = (nm0sets.p2vws[vusr] || "").filt || "") || filtExe();
    }
  },
  ancAdd1 = td2 => {
    //let nanc = document.createElement('a');
    td2.innerHTML = td2.textContent.replace(/.+?(?= \(\d+k\)$|$)/, "<a>$&</a>");
    //nanc.innerHTML = td2.firstChild.innerHTML;
    //nanc.appendChild(td2.firstChild);
    td2.firstChild.onclick = fileLoad;
    //td2.firstChild.replaceWith(nanc);
  },
/*
  fileActv = evt => {
    let td2 = evt.target.parentElement.parentElement.children[2];
    rsp2con.textContent = nmdata.innerHTML = "";
    evt.target.checked || (evt.target.parentElement.parentElement.className = "");
    //evt.target.checked ? ancAdd1(td2) : td2.innerHTML = td2.textContent;
    blk2Tog();
  },
*/
  chksTog = evt => {
    let r1idx = evt.target.parentElement.parentElement.rowIndex - 2,
      sdtrs = document.querySelectorAll('#nmtbl tbody>tr[id]'),
      rsidx = Array.from(sdtrs || "").map(e => e.rowIndex - 2),
      r2idx = rsidx[rsidx.findIndex(n => n === r1idx) + 1]
        || ((document.querySelector('#nmtbl tbody>tr:last-of-type') || "").rowIndex - 1),
      trows = document.querySelectorAll('#nmtbl tbody>tr');
    rsp2con.textContent = "";
    if (!evt.target.parentElement.parentElement.id) {
      evt.target.checked
      || document.querySelectorAll('#nmtbl tbody>tr:not([id])').forEach(tr => tr.className = "");
      document.querySelectorAll(qslrs[4]).forEach(inp => inp.checked = evt.target.checked);
      //document.querySelectorAll('#nmtbl tbody>tr:not([id])>td:nth-of-type(3)')
      //.forEach(td2 => evt.target.checked ? ancAdd1(td2) : td2.innerHTML = td2.textContent);
    } else {
      while (++r1idx < r2idx) {
        evt.target.checked || (trows[r1idx].className = "");
        trows[r1idx].children[0].children[0].checked = evt.target.checked;
        //evt.target.checked
        //? ancAdd1(trows[r1idx].children[2])
        //: trows[r1idx].children[2].innerHTML = trows[r1idx].children[2].textContent;
      }
    }
    blk2Tog();
  },
  sdirXpd = evt => {
    let xpd = evt.target.textContent === "\u25b6",
      rowid = evt.target.parentElement.parentElement.id,
      r1idx = evt.target.parentElement.parentElement.rowIndex - 2,
      sdtrs = document.querySelectorAll('#nmtbl tbody>tr[id]'),
      rsidx = Array.from(sdtrs || "").map(e => e.rowIndex - 2),
      r2idx = rsidx[rsidx.findIndex(n => n === r1idx) + 1]
        || ((document.querySelector('#nmtbl tbody>tr:last-of-type') || "").rowIndex - 1),
      trows = document.querySelectorAll('#nmtbl tbody>tr');
    //rsp2Show([r1idx, r2idx, rowid].join(", "));
    if (rowid) {
      evt.target.innerHTML = !xpd ? "&#x25b6;" : "&#x25bc;";
      while (++r1idx < r2idx) { trows[r1idx].hidden = !xpd; }
    } else {
      document.querySelectorAll(qslrs[2])
      .forEach(anc => anc.innerHTML = !xpd ? "&#x25b6;" : "&#x25bc;");
      document.querySelectorAll('#nmtbl tbody>tr[id]>td:first-of-type>a')
      .forEach(anc => anc.innerHTML = !xpd ? "&#x25b6;" : "&#x25bc;");
      document.querySelectorAll('#nmtbl tbody>tr:not([id])').forEach(tr => tr.hidden = !xpd);
    }
  },
  colsTog = (evt, resel = (nm0sets.p2vws[vusr] || "").sort) => {
    let opts = Array.from(colssel.selectedOptions).map(o => 1 + o.index);
    !evt || (resel = sortsel.value);
    document.querySelectorAll('#nmtbl :not(.dnone)>tr')
    .forEach( tr => Array.from(tr.children).forEach( (td, i) =>
      td.className = !i || opts.indexOf(i) > -1 ? "" : "dnone" ));
    sortsel.innerHTML = vbas === 5 ? `
        <option value=seq>Chg Seq</option>
        <option value=id>Note ID</option>\n`
      : Array.from(colssel.selectedOptions)
        .map(o => `\n          <option value="${ o.value }">${ o.textContent }</option>`)
        .join("") + "\n        ";
    sortsel.value = Array.from(sortsel.options).some(o => o.value === resel) ? resel : "id";
  },
  tblGen = evt => {
    let ss = ( evt && evt.target.id === "sortsel" ? sortsel.value
      : (nm0sets.p2vws[vusr] || "").sort || sortsel.value ).split("."),
      chksRstr = () => {
        bulkctrl.classList.add("dnone");
        filtctrl.classList.remove("dnone");
        filtinp.value = moveinp.value = "";
        document.querySelectorAll(qslrs[2]).forEach(anc => anc.innerHTML = "&#x25b6;");
        document.querySelectorAll(qslrs[3]).forEach(inp => {
          inp.checked = false;
          inp.className = "dnone";
        });
        document.querySelectorAll('#nmtbl tbody>tr[id]>td:first-of-type>input')
        .forEach(inp => inp.onchange = chksTog);
        document.querySelectorAll('#nmtbl tbody>tr:not([id])>td:first-of-type>input')
        .forEach(inp => inp.onchange = blk2Tog);
      };
    !evt || evt.target.id !== "descswi" || ( txd1.OPTIONS = {
      //startkey: descswi.checked ? "~~~" : "",
      //endkey: descswi.checked ? "" : "~~~",
      descending: descswi.checked
    });
    vbas !== 5 || new PouchDB(txd1.DBNAME)
    .changes(txd1.OPTIONS || {})
    .then(rslt => {
      let dels = rslt.results.filter(r => r.deleted);
      ftotal.textContent = dels.length;
      [nmthds[0], nmtfts[0]].forEach(e => e.classList.add("dnone"));
      [nmthds[1], nmtfts[1]].forEach(e => e.classList.remove("dnone"));
      nmtbod.innerHTML = qd5Fmt( ss[0] === "seq" ? dels
        : ordFlip(dels.map(r => [r.id, r])).map(sr => sr[1]) );
      chksRstr();
      colsTog(null, /^(?:id|seq)$/.test(ss[0]) ? ss[0] : "id");
      vwFnlz(evt);
    }).catch(rsp2Show);
    vbas === 5 || new PouchDB(txd1.DBNAME)
    .query(txd1.FILEID.replace(/^_design\//, "") + "/" + txd1.VIEW, txd1.OPTIONS || {})
    .catch( () => new PouchDB(txd1.DBNAME).allDocs({
      startkey: descswi.checked != (vbas === 4) ? "~a" : undefined,
      endkey: descswi.checked != (vbas === 4) ? undefined : "~a",
      descending: descswi.checked,
      include_docs: true })
    ).then(rslt => {
      let calcSum = arr => !arr.length ? 0 : arr.reduce((s, v) => s + v);
      j = 0;
      ftotal.textContent = vbas !== 2 ? rslt.total_rows
        : rslt.rows.filter(r => (r.doc || r.value).file_updated).length
          + calcSum( rslt.rows.filter(r => (r.doc || r.value)._attachments)
            .map(r => Object.keys((r.doc || r.value)._attachments).length) );
      [nmthds[1], nmtfts[1]].forEach(e => e.classList.add("dnone"));
      [nmthds[0], nmtfts[0]].forEach(e => e.classList.remove("dnone"));
      nmtbod.innerHTML = vbas !== 2
      ? qd3Fmt( !ss[0] || vbas !== 4 && ss[0] === "id" || vbas === 4 && ss[1] === "timestamp"
        ? rslt.rows
        : ordFlip( !ss[1] ? rslt.rows.map(r => [(r.doc || r.value)[ss[0]], r.id, r])
          : ss[1] !== "timestamp"
          ? rslt.rows.map(r => [((r.doc || r.value)[ss[0]] || "")[ss[1]], r.id, r])
          : rslt.rows.map( r => [ (rval = r.doc || r.value)[ss[0]]
            ? rval[ss[0]][ss[1]]
            : rval[ss[0].replace(/^file/, "ts")], r.id, r ]) )
        .map(sr => sr[2]) )
      : qd2Fmt( ordFlip( rslt.rows.filter(r => /^[.-]/.test(r.id) || (r.doc || r.value).file_updated)
        .map( r => /^[.-]/.test(r.id) ? [r.id.replace(/^\.(.+)$/, "$1_"), null, r.id, r]
          : [ (rval = r.doc || r.value).file_updated.subdir || ".",
            !ss[1] ? rval[ss[0] || "id"] : (rval[ss[0]] || "")[ss[1]], r.id, r ] ) )
        .map(sr => sr[3]) );
      colsTog(null, ss.join(".") || "file_created.timestamp");
      document.querySelectorAll(qslrs[1])
      .forEach(spn => spn.className = vbas !== 2 ? "" : "dnone");
      document.querySelectorAll(qslrs[2])
      .forEach(anc => anc.className = vbas === 2 ? "" : "dnone");
      document.querySelectorAll('#nmtbl tbody>tr[id]>td:first-of-type>a')
      .forEach(anc => anc.onclick = sdirXpd);
      chksRstr();
      document.querySelectorAll('#nmtbl tbody>tr:not([id])>td:nth-of-type(3)').forEach(ancAdd1);
      vwFnlz(evt);
    }).catch(rsp2Show);
  },
  clipsGen = evt => {
    new PouchDB(txd1.DBNAME)
    .query(txd1.FILEID.replace(/^_design\//, "") + "/" + txd1.VIEW, txd1.OPTIONS || {})
    .catch( () => new PouchDB(txd1.DBNAME).allDocs({
      startkey: descswi.checked ? "~a" : undefined,
      endkey: descswi.checked ? undefined : "~a",
      descending: descswi.checked,
      include_docs: true }) )
    .then(rslt => {
      let na, nb, ra, rb,
        nsX = nf => nf.trim()
          .replace(/(.*?) *((?:\bde +|\bvon +|)['\w-]+)([ ,]*\b[js]r\.?|[ ,]*\b[ivx]+|)$/i, "$2, $1$3"),
        rrs = rslt.rows.filter(r => r && ( /contact|phone/.test((r.doc || r.value).file_type || "")
            || (ra = a.doc || a.value).name_full || ra.name_user || ra.name ))
          .sort( (a, b) => !(na = (ra = a.doc || a.value).name_full || ra.name_user || ra.name || ra._id)
              || !(nb = (rb = b.doc || b.value).name_full || rb.name_user || rb.name || rb._id) ? 0
            : (nsX(na).replace(/[.,;:/]/g, "") < nsX(nb).replace(/[.,;:/]/g, ""))
              == descswi.checked ? 1 : -1 );
      ftotal.textContent = rrs.length;
      nmdata.innerHTML = "\n<span class=\"fltrt mtup3\">&ensp;Show all:&ensp;"
      + "<label><input type=checkbox id=cbxhdrs /> <a>headers</a></label>&ensp;"
      + "<label><input type=checkbox id=cbxbods /> <a>bodies</a></label></span>\n<hr />"
      + (rrs.length ? "" : "\n<p class=igreyd>&emsp;<em>[No results found &hellip;]</em><p>")
      + rrs.map( r => `
<article class=media>
  <div class="media-left">
    <figure class="image rspv128"><img src="${
      aurlGen((ra = r.doc || r.value).image_src || "") }" data-fileid="${ r.id }" />
    <figcaption>${ ra.name_user || "" }</figcaption></figure>
  </div>
  <div class="media-content">
    <div class=pwrap><span class=dnone><input type=checkbox /> </span><strong>${
      nsX(ra.name_full || ra.name_user || ra.name || ra._id) }</strong>
<em>${ ra.roles.join(", ") }</em>
<details><summary>Short Bio</summary>${ ra.bio_short }</details></div>
    <div class=pwrap><details><strong>Birthdate:</strong> ${ date1Fmt(ra.birthdate) }
<strong>Emails:</strong> ${ ra.emails.join(", ") }
<strong>Phones:</strong> ${ ra.phones.join(", ") }${
      !ra.social_profiles.length ? ""
        : "\n<strong>Social profiles:</strong> " + ra.social_profiles.join(", ") }${
      !ra.project_urls.length ? ""
        : "\n<strong>Project urls:</strong> " + ra.project_urls.join(", ") }${
      !ra.ts_created ? ""
        : "\n<strong>Joined team:</strong> " + date1Fmt(ra.ts_created) }${
      !ra.ts_updated ? ""
        : "\n<strong>Last updated:</strong> " + date1Fmt(ra.ts_updated) }</details></div>
  </div>
</article>` ).join("") + "\n";
      cbxhdrs.onchange = evt => document.querySelectorAll('#nmdata .media-content>:first-child>details')
        .forEach(e => e.open = evt.target.checked);
      cbxbods.onchange = evt => document.querySelectorAll('#nmdata .media-content>:last-child>details')
        .forEach(e => e.open = evt.target.checked);
      document.querySelectorAll('#nmdata .media-left>.image>img').forEach(e => e.onclick = fileLoad);
      document.querySelectorAll('#nmdata .media-content>.pwrap>span>input')
      .forEach(inp => inp.onchange = blk2Tog);
      vidx > 8 && !(nm0sets.p2vws[vusr] || "").hdrs || cbxhdrs.click();
      !(nm0sets.p2vws[vusr] || "").bods || cbxbods.click();
      vwFnlz(evt);
    }).catch(rsp2Show);
  },
  tabActv = evt => {
    !evt || evt.currentTarget.localName === 'a' || (evt = null);
    tidx = !evt ? (vidx > 3 ? 0 : vidx) : +evt.currentTarget.parentElement.dataset.tabidx;
    [nmflow, nmdata].some(e => !e.classList.contains('dnone')) || (viewsel.selectedIndex = vidx = tidx);
    pdbssel.selectedIndex > 1 || vidx === 2 || (pdbssel.selectedIndex = 0);
    pdbssel.selectedIndex === 1 || nm0sets.usecfg || !cfgcbx.checked || cfgcbx.click();
    !/0|1|3/.test(vidx) || (ftotal.textContent = "_");
    tabncs.forEach(anc => anc.parentElement.classList.remove('is-active'));
    (!evt ? tabncs[tidx] : evt.currentTarget).parentElement.classList.add('is-active');
    nmpans.forEach(e => e.classList.add("dnone"));
    nmpans[tidx].classList.remove("dnone");
    if (tidx === 1 && !fwg) {
      let txtaHt = k => /body|content/i.test(k) ? 16 : /misc/i.test(k) ? 8
          : typeof fwg[k] !== 'object' || Array.isArray(fwg[k]) && typeof fwg[k][0] !== 'object' ? 2
          : !Array.isArray(fwg[k]) && Object.keys(fwg[k]).length < 8 ? 8 : 16;
      fwg = JSON.parse( JSON.stringify(
        (nm0sets.p2typs[t00sel.value] || "").t1 || pntyps[t00sel.value] || pntyps.new ));
      pnacnt.innerHTML = "\n<h4>New Note</h4>\n<button id=savbtn class=\"hgainl fltrt mtup28\">"
      + "<span class=isucc>&#x267a;</span> SAVE</button>\n<div class=\"cfield alnrt\">"
      + "\n<div class=\"chelp isucc lnh14 dnone\">New note is saved in local DB.</div>"
      + "\n<div class=\"chelp iwarn lnh14 dnone\">New-note save attempt failed.</div>\n</div>"
      + "\n<div>&nbsp;</div>" + Object.keys(fwg).map(k => /^_rev$/.test(k) ? "" : `
<div class="cfield is-horizontal">
  <div class="field-label">
    <span class=label>${k}</span>
    <button class="fltrt bsml ilink" data-seltrg=${"p0" + k}>sel</button>
  </div>
  <div class="field-body">
    <textarea id=${"p0" + k} class=textarea rows=${txtaHt(k)}>${
      vtoStr(fwg[k], !Array.isArray(fwg[k]) || typeof fwg[k][0] === 'object' ? 2 : null)
      .replace(/&(?=#?\w+;)/g, "&amp;").replace(/<(?=[!/?a-z])/gi, "&lt;") }</textarea>
  </div>
</div>`).join("") + "\n";
      savbtn.onclick = () => {
        fwg = null;
        let hlps = pnacnt.querySelectorAll('.chelp');
        hlps.forEach(e => e.classList.add("dnone"));
        hlps[0].classList.remove("dnone");
      }; //fwgUpd;
      pnacnt.querySelectorAll('.field-label button').forEach(e => e.onclick = txtaSel);
    }
  },
  viewRte = evt => {
    [nmflow, nmdata].forEach(e => e.classList.add("dnone"));
    nmtbod.innerHTML = nmdata.innerHTML = "";
    if (!window.PouchDB || !txd1.DBNAME) {
      ftotal.textContent = "_";
      window.PouchDB || !txd1.DBNAME || rsp2con.textContent
      || rsp2Show("Alert: PouchDB is not loaded. Database is inaccessible.");
      pdbssel.selectedIndex === 1
      || [nmflow, nmdata].some(e => !e.classList.contains('dnone')) || tabActv();
    } else if (vbas < 2) {
      rsp2con.textContent = "";
      !vbas ? tabActv() : nmdata.classList.remove("dnone") || clipsGen(evt);
    } else if (vbas) {
      rsp2con.textContent = "";
      nmflow.classList.remove("dnone");
      tblGen(evt);
    }
    !evt || !vbas || tidx !== 1 || tabActv();
  },
  viewChg = evt => {
    let vkey = viewsel.value.replace(/-?\d+$|^V\d:/g, "") || "myview";
    if (vidx > 3 && evt && evt.currentTarget.localName === 'a') { return tabActv(evt); }
    vidx = !evt || evt.currentTarget.localName !== 'a' ? viewsel.selectedIndex
      : +evt.currentTarget.parentElement.dataset.tabidx;
    vidx < 4 || txd1.DBNAME || pdbssel.selectedIndex === 1 || (viewsel.selectedIndex = vidx = 0);
    vbas = viewsel.selectedIndex > 3 && +/\d/.exec(viewsel.value);
    txd1.VIEW = vbas === 4 ? "files-static" : vbas === 1 ? "files-contact" : "files-idxlist";
    if (vidx !== 2) {
      (colssel.innerHTML = !vbas ? "" : copts[vbas !== 5 ? 0 : 1]);
      vidx > 3 || (sortsel.innerHTML = "") || (colssel.selectedIndex = -1);
      descswi.checked = false;
      bulkctrl.classList.add("dnone");
      filtctrl.classList.remove("dnone");
      filtinp.value = moveinp.value = "";
      v02inp.value = v01inp.value = "";
    }
    if (vidx < 4 && evt && [nmflow, nmdata].every(e => e.classList.contains('dnone'))) {
      return tabActv(evt);
    }
    v01inp.value = vkey + "-" + ( 1
      + ( Array.from(v00sel.options).map(o => o.value.includes(vkey) && /\d+$/.exec(o.value))
        .filter(e => e).map(e => +e).sort().reverse()[0] || 1 ) );
    vusr = "";
    ( vidx > 8 ? (nm0sets.p2vws[vusr = viewsel.value.replace(/^V\d-/, "")] || "").cols || []
      : [[1, 2, 3, 4, 5], [0, 1, 2, 3, 4, 5, 21], [1, 2, 7, 8, 14, 15, 16, 17], [0, 1, 2]][vidx - 5] || [] )
    .forEach(n => colssel.options[n].selected = true);
    vidx < 4 || !colssel.innerHTML || colsTog();
    vidx < 9 || (descswi.checked = (nm0sets.p2vws[vusr] || "").desc);
    viewRte(evt);
  },
  pdbOpen = () => {
    pnacnt.innerHTML = fwg = null;
    !pdbssel.options[3] || (nmtips.innerHTML = "");
    pdbnam.innerHTML = txd1.DBNAME = pdbssel.selectedIndex < 2 ? "" : pdbssel.value;
    !window.PouchDB || !txd1.DBNAME ? (pdbseq.innerHTML = pdbtot.innerHTML = "")
    : new PouchDB(txd1.DBNAME).info()
      .then(r => [pdbtot.innerHTML, pdbseq.innerHTML] = [r.doc_count, r.update_seq]).catch(rsp2Show);
    pdbssel.selectedIndex < 2 ? (opencbx.checked = viewsel.selectedIndex = vidx = 0)
      || pnahlp.classList.remove("dnone") || pnacnt.classList.add("dnone") || (opencbx.disabled = 1)
    : pnahlp.classList.add("dnone") || pnacnt.classList.remove("dnone") || (opencbx.disabled = 0)
      || vidx > 3 || (viewsel.selectedIndex = vidx = 4 + v0ssel.selectedIndex);
    Array.from(viewsel.options).forEach((o, i) => i < 4 || (o.disabled = vidx < 4));
    opencbx.disabled || (opencbx.checked = (txd1.DBNAME === nm0sets.dbdflt));
    viewChg();
    pdbssel.selectedIndex !== 1 || !(viewsel.selectedIndex = vidx = 2)
    || cfgcbx.checked || cfgcbx.click();
    (!vidx || vidx > 3) && !tidx || tabActv();
  },
  t1sChg = evt => {
    let dtOpts = v => ["string", "number", "boolean", "object",
        "arr of str", "arr of nbr", "arr of bln", "arr of obj", "arr of any", "other"].map( e =>
          "\n      <option" + (e !== v ? ">" : " selected>") + e + "</option>" ).join("") + "\n      ";
    if (evt && evt.target.id !== "t00sel") {
      let ntr,
        tkey = t00sel.value.replace(/-?\d+$/, "") || "mytype";
      evt.target.localName !== 'select' || ( evt.target.parentElement.nextSibling.firstChild.value
        = ["", "0", "false", "{ \"key\": \"val\" }", "[\"\"]", "[0]", "[true]",
          "[ { \"key\": \"val\" } ]", "[ \"\", 0, false, {}, [] ]", ""][evt.target.selectedIndex] );
      evt.target.parentElement.previousSibling
      || evt.target.parentElement.parentElement.nextElementSibling
      || !evt.target.value || !(ntr = document.createElement('tr'))
      || !( ntr.innerHTML = "<td><input type=text /></td><td><select>" + dtOpts()
        + "</select></td><td><input type=text /></td>" ) || !t1tbod.appendChild(ntr)
      || ntr.querySelectorAll('input, select').forEach(e => e.onchange = t1sChg);
      return t01inp.value || ( t01inp.value = tkey + "-" + ( 1
        + ( Array.from(t00sel.options).map(o => o.value.includes(tkey) && /\d+$/.exec(o.value))
          .filter(e => e).map(e => +e).sort().reverse()[0] || 1 ) ));
    }
    t02inp.value = t01inp.value = "";
    t1tbod.innerHTML = Object.entries( t00sel.selectedIndex < 6
        ? pntyps[t00sel.value] || pntyps.new : nm0sets.p2typs[t00sel.value].t1 )
      .concat([["", ""]]).map( ([k, v], i) => k === "_rev" ? ""
        : "\n      <tr><td><input type=text value=\"" + k + "\"" + (i ? "" : " disabled")
          + " /></td><td><select>" + dtOpts(typeof v)
          + "</select></td><td><input type=text value='"
          + vtoStr(v) + "' /></td></tr>" ).join("") + "\n      ";
    t1tbod.querySelectorAll('input, select').forEach(e => e.onchange = t1sChg);
  },
  t0sChg = () => {
    let t0s = [ ["", ""], ["srcdoc", "Web source document"],
        ["scrap", "No-frills, plain-text note"], ["event", "Calendaring item or logging record"],
        ["memo", "Short memorandum or text msg"], ["contact", "Person's contact information"] ]
        .concat(Object.values(nm0sets.p2typs).map(v => v.t0));
    t00sel.innerHTML = t0s.map( ([k, v], i) => "\n      <option"
      + (i !== 2 ? ">" : " selected>") + k + "</option>" ).join("") + "\n      ";
    t0tbod.innerHTML = t0s.map( ([k, v], i) => !i ? ""
      : "\n      <tr><td>" + (i < 5 ? "" : "<label>")
        + "<input type=checkbox" + (i > 4 ? "" : " disabled")
        + " />&ensp;" + k + (i < 5 ? "" : "</label>")
        + "</td><td>" + v + "</td></tr>" ).join("") + "\n      ";
  },
  v0sChg = () => {
    let v0v = !v00sel.innerHTML ? "V2:organized" : v00sel.value,
      v0s = [ ["V1:noteclips", "Preview <em>event</em>/<em>memo</em>/<em>contact</em>'s"],
          ["V2:organized", "Notes/attach's by subdirectory"], ["V3:mutables", "All updatable notes"],
          ["V4:statics", "All one-off, text post/<em>memo</em>'s"],
          ["V5:deleted", "All discarded-note IDs"] ]
        .concat(Object.values(nm0sets.p2vws).map(vo => vo.v0));
    v00sel.innerHTML = v0s.map( ([k, v], i) =>
      "\n      <option>" + k + "</option>" ).join("") + "\n      ";
    v00sel.value = v0v;
    v0tbod.innerHTML = v0s.map( ([k, v], i) =>
      "\n      <tr><td>" + (i < 5 ? "" : "<label>")
      + "<input type=checkbox" + (i > 4 ? "" : " disabled")
      + " />&ensp;" + k + (i < 5 ? "" : "</label>")
      + "</td><td>" + v + "</td></tr>" ).join("") + "\n      ";
    v0ssel.innerHTML = v0s.map( ([k, v]) => "\n      <option"
      + (k.replace(/^(V\d):.+/, "$1") !== nm0sets.vwdflt ? ">" : " selected>")
      + k + "</option>" ).join("") + "\n      ";
  },
  viewApd = (add = viewsel.value) => {
    let vw2s = Object.values(nm0sets.p2vws).map(v => v.cbxs !== 0 && v.v0[0]).filter(e => e);
    if (viewsel.options.length !== 9 + vw2s.length || add !== viewsel.value) {
      v0sChg();
      viewsel.innerHTML = Array.from(viewsel.options)
        .filter((o, i) => i < 9).map(o => "\n      " + o.outerHTML)
        .concat(vw2s.map(e => "\n      <option>" + e + "</option>")).join("") + "\n      ";
      viewsel.value = add;
    }
    !txd1.DBNAME || viewsel.selectedIndex > 3 || !(viewsel.selectedIndex = vidx = 5) || viewChg();
  },
  setsUpd = evt => {
    let hid = !vbas || ( vbas !== 1
        ? document.querySelector('#nmtbl thead:not(.dnone) td:first-of-type>input.dnone')
        : document.querySelector('#nmdata .media-content>.pwrap>span.dnone') ),
      ps = ["dbdflt", "dbdflt", "vwdflt", "uname", "uemail", "usecfg", "useset"],
      idx = evt && actrls.concat([cfgcbx, setcbx, t0abtn, t0dbtn, v0abtn, v0dbtn])
        .findIndex(e => e.id === evt.target.id);
    if (typeof idx === 'number' && idx > -1) {
      idx || (opensel.value = !opencbx.checked ? "" : txd1.DBNAME);
      idx < 7 ? ( nm0sets[ps[idx]] = !idx ? opensel.value : idx > 4 ? evt.target.checked
        : idx !== 2 ? evt.target.value : evt.target.value.replace(/^(V\d):.+/, "$1") )
      : idx < 8 && t01inp.value ? ( nm0sets.p2typs[t01inp.value]
        = { t0: [t01inp.value, t02inp.value],
          t1: Object.fromEntries( Array.from(t1tbod.querySelectorAll('tr'))
            .map(tr => tr.children[0].value && [tr.children[0].value, tr.children[2].value])
            .filter(e => e) ) } )
      : idx < 9 ? t0tbod.querySelectorAll('[type=checkbox]:checked')
        .forEach(e => delete nm0sets.p2typs[e.parentElement.innerText.replace(/^\s/, "")])
      : idx < 10 && vbas && v01inp.value ? ( nm0sets.p2vws[v01inp.value]
        = { v0: ["V" + vbas + "-" + v01inp.value, v02inp.value], base: vbas,
          cols: Array.from(colssel.options)
            .map((o, i) => o.selected && i).filter(e => typeof e === 'number'),
          sort: sortsel.value, desc: descswi.checked, filt: filtinp.value, cbxs: !hid,
          hdrs: vbas < 2 && cbxhdrs.checked, bods: vbas < 2 && cbxbods.checked } )
      : v0tbod.querySelectorAll('[type=checkbox]:checked')
        .forEach(e => delete nm0sets.p2vws[e.parentElement.innerText.replace(/^\s?V\d-/, "")]);
      localStorage._nm0sets = JSON.stringify(nm0sets);
      idx < 9 || !v01inp.value || viewApd(idx === 9 && nm0sets.p2vws[v01inp.value].v0[0])
      || idx > 9 || (v00sel.value = nm0sets.p2vws[v01inp.value].v0[0]);
      v00sel.selectedIndex > -1 || (v00sel.selectedIndex = 1);
    }
  },
  pdbsGen = (dbs = []) => {
    !/^{['"].+}$/.test(localStorage._nm0cfgs || "")
    || (nm0cfgs = fncTry(localStorage._nm0cfgs, JSON.parse) || {});
    !/^{['"].+}$/.test(localStorage._nm0sets || "")
    || (nm0sets = fncTry(localStorage._nm0sets, JSON.parse));
    nm0sets && ["uemail", "uname", "dbdflt", "vwdflt", "usecfg", "useset", "p2typs", "p2vws"]
      .every(pty => nm0sets.hasOwnProperty(pty))
    || ( localStorage._nm0sets = JSON.stringify( nm0sets = Object.assign(
      { uemail: "", uname: "", dbdflt: "", vwdflt: "V2", usecfg: 0, useset: 0,
        p2typs: { mytype2: { t0: ["mytype2", "<em>[mytype2 description &hellip;]</em>"],
            t1: { _id: "", _rev: "", key2: "", key3: "" } }},
        p2vws: { myview2: { v0: ["V1-myview2", "<em>[myview2 description &hellip;]</em>"],
            base: 1, cols: [], sort: "", desc: 0, filt: "", cbxs: 0, hdrs: 1, bods: 0 }} },
      nm0sets || {} )));
    !nm0sets.u2typs || delete nm0sets.u2typs;
    !nm0sets.u2vws || delete nm0sets.u2vws;
    [pdbssel, opensel].forEach( (e, i) => e.innerHTML
      = ["\n      <option></option>", i ? "" : "\n      <option>&plus; New DB</option>"]
        .concat(dbs.map(e => "\n      <option>" + e + "</option>")).join("") + "\n      " );
    unaminp.value = una2inp.value = nm0sets.uname;
    uemlinp.value = nm0sets.uemail;
    !nm0sets.useset || setcbx.checked || setcbx.click();
    viewApd() || viewsel.options.length > 9 || v0sChg();
    t0sChg();
    t1sChg();
    opensel.value = pdbssel.value = nm0sets.dbdflt;
    !pdbssel.value || pdbOpen();
  };
pdbssel.onchange = pdbOpen;
viewsel.onchange = viewChg;
colssel.onchange = colsTog;
sortsel.onchange = viewRte;
descswi.onchange = viewRte;
filtbtn.onclick = filtExe;
blktrig.onclick = bulkTog;
document.querySelectorAll('#vctrls #movebtn, #vctrls #delbtn').forEach(btn => btn.onclick = filesChg);
document.querySelectorAll(qslrs[2]).forEach(anc => anc.onclick = sdirXpd);
document.querySelectorAll('#nmtbl td:first-of-type>input').forEach(inp => inp.onchange = chksTog);
tabncs.forEach(anc => anc.onclick = viewChg);
t00sel.onchange = t1sChg;
actrls.forEach(elm => elm.onchange = setsUpd);
[[cfgcbx, pdbcfg], [setcbx, nmsets]].forEach( ([c, e]) => c.onclick = evt => e.querySelectorAll('p')
  .forEach(p => p.classList[!c.checked ? "add" : "remove"]("dnone")) || setsUpd(evt) );
[t0abtn, v0abtn, t0dbtn, v0dbtn].forEach(e => e.onclick = setsUpd);
jselbtn.onclick = txtaSel;
jsctxta.onblur = jscEval;
!window.PouchDB || !PouchDB.allDbs ? pdbsGen() : PouchDB.allDbs().then(pdbsGen).catch(rsp2Show);
</script>
</html>
